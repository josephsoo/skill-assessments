# R for Data Science assessment

```{r}
options(repos = "http://cran.us.r-project.org") 
#import and load the required packages
if (!require(ggpubr)) {
  install.packages("ggpubr")
}
library(ggpubr)
if (!require(tidyverse)) {
  install.packages("tidyverse")
}
library(tidyverse)

if (!require(ggplot2)) {
  install.packages("ggplot2")
}
library(ggplot2)
if (!require(plotly)) {
  install.packages("plotly")
}
library(plotly)


if (!require(moments)) {
install.packages("moments")
}
library(moments)
if (!require(LambertW)) {
  install.packages("LambertW")
}
library(LambertW)
```

## 1. Reading the gapminder into a tibble

```{r}
gapminder <- read_csv("gapminder_clean.csv")
gapminder
```
## 2. Filtering and plotting the data
```{r}
gapminder_filtered <- filter(gapminder, Year == 1962)
gapminder_filtered

gapminder_plot <- ggplot(gapminder_filtered, aes(x = gdpPercap,
  y = `CO2 emissions (metric tons per capita)`)) +
  geom_point()
  ggsave("gapminderplot.png")
 
gapminder_plot
```

## 3. Finding correlation
```{r}
correlation <- cor(gapminder_filtered$`CO2 emissions (metric tons per capita)`,
  gapminder_filtered$gdpPercap, use = "complete.obs")
p_value <- cor.test(gapminder_filtered$`CO2 emissions (metric tons per capita)`,
  gapminder_filtered$gdpPercap)$p.value
correlation
p_value
```

## 4
```{r}
gapminder_filtered <- gapminder %>%
  filter(!is.na(`CO2 emissions (metric tons per capita)`), !is.na(gdpPercap))

cor_by_year <- gapminder_filtered %>%
  group_by(Year) %>%
  summarise(correlation = cor(`CO2 emissions (metric tons per capita)`, gdpPercap, use = "complete.obs"))
  
cor_by_year
strongest_year_row <- cor_by_year %>%
  filter(correlation == max(correlation)) %>%
  slice(1)

strongest_year <- strongest_year_row
strongest_year

```

## 5
```{r}

gapminder_strongest_year <- gapminder %>%
  filter(Year == 1967)

gapminder_strongest_year
strongest_year_plot <- ggplot(gapminder_strongest_year, 
  aes(x = gdpPercap, y = `CO2 emissions (metric tons per capita)`, 
  color = continent, 
  size = pop)) +
  geom_point()
ggplotly(strongest_year_plot)


```

## 1
### What is the relationship between continent and 'Energy use (kg of oil equivalent per capita)'? (stats test needed)

We want to test if there is a statistically significant difference in the Energy use per continent. Thus, continent is the predictor variable, and energy use is the outcome variable. 

To use a parametric test, we must ensure that three assumptions are met: Normality, equal variances, and independence.

Normality assumption:
To check for normality, we use a qqplot.

```{r}
# ggqqplot(data = gapminder, x = `Energy use (kg of oil equivalent per capita)`, facet.by = 'continent')

ggplot(gapminder, aes(x = `Energy use (kg of oil equivalent per capita)`)) +
  geom_histogram(bins = 30) +
  facet_wrap(~ continent, scales = "free") +
  xlab("Energy use (kg of oil equivalent per capita)") +
  ylab("Frequency")
```

As we can see, the data is not normally distributed. Therefore, we use a Kruskal-Wallis test

```{r}
kruskal.test(gapminder$`Energy use (kg of oil equivalent per capita)`, gapminder$continent, na.action = "na.omit")
```
As we can see, the p value is less than 2.2e-16, which is less than 0.05, which means that the energy use varies significantly between at least two continents.


## 2
Is there a significant difference between Europe and Asia with respect to 'Imports of goods and services (% of GDP)' in the years after 1990? (stats test needed)
### Filtering the data

```{r}
gapminder_years <- gapminder %>%
  filter(Year > 1990) %>%
  filter(continent == "Asia" | continent == "Europe")
```
### Visualizations 
```{r}
# Create box plots
box_plot <- ggplot(gapminder_years, aes(x = continent, y = `gdp`, fill = continent)) +
  geom_boxplot() +
  labs(x = "Continent", y = "Imports of goods and services (% of GDP)", fill = "Continent") +
  ggtitle("Box Plots of GDP Imports by Continent")

ggplotly(box_plot)

# Create density plots
density_plot <- ggplot(gapminder_years, aes(x = `gdp`, fill = continent)) +
  geom_density(alpha = 0.5) +
  labs(x = "Imports of goods and services (% of GDP)", fill = "Continent") +
  ggtitle("Density Plots of GDP Imports by Continent")

ggplotly(density_plot)
```

Visually, the two continent's GPD is very close and have much overlap, although the variances appear to be different and there appears to be 4 outliers for Asia.

### Plotting a qqplot
```{r}


# Filter data for the years after 1990
data <- gapminder_years


# Rename the variable for convenience
gapminder_years <- gapminder_years %>% 
rename(gdp = `Imports of goods and services (% of GDP)`)

# Plot Q-Q plot with facet by continent
ggplotly(ggqqplot(data = gapminder_years, x = "gdp", facet.by = "continent"))

```
For Asia, there are a few points with a high GDP above the diagonal line. As normality has been violated, it would not be appropriate to use a parametric test, so we use a Mann-Whitney-Wilcoxon Test.

### Perform Mann-Whitney-Wilcoxon Test
```{r}
result <- wilcox.test(gdp ~ continent, data = gapminder_years)
print(result)
```
As the p-value is greater than 0.05, there is not a significant difference in GDP between Europe and Asia

## 3 

