# R for Data Science assessment

```{r}
options(repos = "http://cran.us.r-project.org") 
#import and load the required packages
#install.packages("tidyverse")
#install.packages("plotly")
library(tidyverse)
library(ggplot2)
library(plotly)
if (!require(ggpubr)) {
install.packages("ggpubr")
}
if (!require(moments)) {
install.packages("moments")
}
library(ggpubr)

```

## 1. Reading the gapminder into a tibble

```{r}
setwd('R for Data Science')
gapminder <- read_csv("gapminder_clean.csv")
gapminder
```
## 2. Filtering and plotting the data
```{r}
gapminder_filtered <- filter(gapminder, Year == 1962)
gapminder_filtered

gapminder_plot <- ggplot(gapminder_filtered, aes(x = gdpPercap,
  y = `CO2 emissions (metric tons per capita)`)) +
  geom_point()
  ggsave("gapminderplot.png")
 
gapminder_plot
```

## 3. Finding correlation
```{r}
correlation <- cor(gapminder_filtered$`CO2 emissions (metric tons per capita)`,
  gapminder_filtered$gdpPercap, use = "complete.obs")
p_value <- cor.test(gapminder_filtered$`CO2 emissions (metric tons per capita)`,
  gapminder_filtered$gdpPercap)$p.value
correlation
p_value
```

## 4
```{r}
#cor_by_year <- gapminder |>
#  group_by(Year) |>
#  summarise(cor(gapminder_filtered$`CO2 emissions (metric tons per capita)`,
#  gapminder_filtered$gdpPercap, use = "complete.obs"))

# strongest_year_row <- filter(cor_by_year, correlation == max(correlation))
# strongest_year_row
# strongest_year <- strongest_year_row$Year
# strongest_year

gapminder_filtered <- gapminder %>%
  filter(!is.na(`CO2 emissions (metric tons per capita)`), !is.na(gdpPercap))

cor_by_year <- gapminder_filtered %>%
  group_by(Year) %>%
  summarise(correlation = cor(`CO2 emissions (metric tons per capita)`, gdpPercap, use = "complete.obs"))
  
cor_by_year
strongest_year_row <- cor_by_year %>%
  filter(correlation == max(correlation)) %>%
  slice(1)

strongest_year <- strongest_year_row
strongest_year

```

## 5
```{r}

gapminder_strongest_year <- gapminder %>%
  filter(Year == 1967)

gapminder_strongest_year
strongest_year_plot <- ggplot(gapminder_strongest_year, 
  aes(x = gdpPercap, y = `CO2 emissions (metric tons per capita)`, 
  color = continent, 
  size = pop)) +
  geom_point()
ggplotly(strongest_year_plot)


```

## 1

We want to test if there is a statistically significant difference in the Energy use per continent. Thus, continent is the predictor variable, and energy use is the outcome variable. 

To use a parametric test, we must ensure that three assumptions are met: Normality, equal variances, and independence.

Normality assumption:
To test for normality, we conduct a Shapiro-Wilk Test for Normality.

```{r}
#Conduct Shapiro-Wilk Test for normality 
shapiro.test(gapminder$"Energy use (kg of oil equivalent per capita)")
```
As we can see, the p value of the test is < 2.2e-16, which is less than the alpha level of 0.05. This suggests that the samples do not come from a normal distribution.



Therefore, we conduct a Kruskal-Wallis H test
```{r}
kruskal.test(`Energy use (kg of oil equivalent per capita)` ~ continent, data = gapminder)
```
Thus can reject the null hypothesis that there is no difference in the mean ranks of energy use across continents.
```{r}
ggplot(gapminder, aes(x = `Energy use (kg of oil equivalent per capita)`)) +
geom_histogram(bins = 30) +
facet_wrap(~continent) +
labs(title = "Histogram of energy use per capita by continent",
x = "Energy use (kg of oil equivalent per capita)",
y = "Frequency")

#convert ggplot2 plot to plotly plot
ggplotly()
``` 

## 2
Is there a significant difference between Europe and Asia with respect to 'Imports of goods and services (% of GDP)' in the years after 1990? (stats test needed)

### Filtering the data

```{r}
gapminder_years <- gapminder %>%
  filter(Year > 1990)
```

### Plotting a qqplot
```{r}
# ggqqplot(data = gapminder_years, x = 'Imports of goods and services (% of GDP)', facet.by = 'continent')

# Filter data for the years after 1990
data <- gapminder %>% 
filter(Year > 1990) %>% 
 select(continent, Year, `Imports of goods and services (% of GDP)`)

# Rename the variable for convenience
data <- data %>% 
rename(gdp = `Imports of goods and services (% of GDP)`)

# Plot Q-Q plot with facet by continent
ggqqplot(data = data, x = "gdp", facet.by = "continent")

```
### Shapiro-Wilk Test for Normality


```{r}
europe <- gapminder_years %>% 
filter(continent == "Europe")

asia <- gapminder_years %>% 
filter(continent == "Asia")

skewness(europe$'Imports of goods and services (% of GDP)', na.rm = TRUE)
kurtosis(europe$'Imports of goods and services (% of GDP)', na.rm = TRUE)
shapiro.test(europe$'Imports of goods and services (% of GDP)'[complete.cases(data)]) 
skewness(asia$'Imports of goods and services (% of GDP)', na.rm = TRUE) 
kurtosis(asia$'Imports of goods and services (% of GDP)', na.rm = TRUE) 
shapiro.test(asia$'Imports of goods and services (% of GDP)'[complete.cases(data)]) 
```
As we can see, the p-values are less than 0.05. Therefore, we can reject the null hypothesis that the data is normally distributed, and we can apply a log transform.

